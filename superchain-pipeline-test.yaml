name: superchain-pipeline-test
version: 1
status: ACTIVE
resource_size: s
apiVersion: 3
sources:
  base.receipt_transactions:
    dataset_name: base.receipt_transactions
    version: 1.2.0
    type: dataset
    start_at: earliest
  optimism.raw_transactions:
    dataset_name: optimism.raw_transactions
    version: 1.0.0
    type: dataset
    start_at: earliest
  zora.raw_transactions:
    dataset_name: zora.raw_transactions
    version: 1.0.0
    type: dataset
    start_at: earliest

transforms:
  cumulative_transaction_count:
    sql: >
      SELECT
        from_address AS wallet,
        COUNT(*) AS transaction_count
      FROM
        raw_transactions
      GROUP BY
        from_address
    primary_key: wallet

  contracts_interacted_with:
    sql: >
      SELECT
        from_address AS wallet,
        COUNT(DISTINCT to_address) AS contracts_interacted
      FROM
        raw_transactions
      GROUP BY
        from_address
    primary_key: wallet

  wallet_age:
    sql: >
      SELECT
        from_address AS wallet,
        MIN(block_timestamp) AS first_transaction_time
      FROM
        raw_transactions
      GROUP BY
        from_address
    primary_key: wallet

  total_bridged_amount:
    sql: >
      SELECT
        from_address AS wallet,
        SUM(value) AS total_bridged
      FROM
        raw_transactions
      WHERE
        to_address IN ('list_of_bridge_contract_addresses')
      GROUP BY
        from_address
    primary_key: wallet

sinks:
  postgres_base.receipt_transactions_public_base_receipt_transactions:
    type: postgres
    table: base_receipt_transactions
    schema: public
    secret_name: POSTGRES_SECRET_CLZGLZV1Z0
    description: 'Postgres sink for Dataset: base.receipt_transactions'
    from: base.receipt_transactions
  postgres_optimism.raw_transactions_public_optimism_raw_transactions:
    type: postgres
    table: optimism_raw_transactions
    schema: public
    secret_name: POSTGRES_SECRET_CLZGLZV1Z0
    description: 'Postgres sink for Dataset: optimism.raw_transactions'
    from: optimism.raw_transactions
  postgres_zora.raw_transactions_public_zora_raw_transactions:
    type: postgres
    table: zora_raw_transactions
    schema: public
    secret_name: POSTGRES_SECRET_CLZGLZV1Z0
    description: 'Postgres sink for Dataset: zora.raw_transactions'
    from: zora.raw_transactions
